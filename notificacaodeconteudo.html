<!DOCTYPE html>
<html>
<head>
  <title>Notificações O GLOBO</title>
  
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" type="text/css" href="notificacao/css/index_oglobo.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async='async'></script>
  <script src="notificacao.js"></script>
  <script>
	  function navegadorSuportaNotificacao() {
  if ("Notification" in window)
    return true;
  else
    return false;
}
    function leitorJaConfigurouNotificacoes() {
	if (navegadorSuportaNotificacao()) {
		if (Notification.permission !== "default")
			return true;
	}
	return false;
}
	  
	  var temporaryPermissionStatus = "";
	  function polling() {
		  if (temporaryPermissionStatus !== Notification.permission) {
			  temporaryPermissionStatus = Notification.permission;
			  
			  if (leitorJaConfigurouNotificacoes()) {
				  console.log("não vamos beber, mas a permissão é " + temporaryPermissionStatus);
			  }
		  }
		  setTimeout(function() { polling(); }, 500);
	  }
	  
	  function inicializa()
	  {
		  var OneSignal = window.OneSignal || [];
      OneSignal.push(["init", {
      appId: "b4d189a8-3ad8-497b-93ec-b50bfa590a8e",
      autoRegister: true, /* Set to true to automatically prompt visitors */
      welcomeNotification: {
        title: "Notificações O GLOBO",
        message: "Obrigado! Agora você será notificado sempre que houver notícias importantes para manter-se informado."
      },
      notifyButton: {
        enable: false /* Set to false to hide */
      }
      }]);
	  }
	  
	  function confirma() {
		  if (leitorJaConfigurouNotificacoes())
      console.log('vamo beber!');
		  else 
			  console.log('ainda não vamo beber!');
	  }
	  
  function subscrever() {
	  inicializa();
	  polling();
       
   
    
    /*if (navigator.serviceWorker.ready) {
     // if (!("Notification" in window)) {
     //   alert("This browser does not support desktop notification");
     //}
      Notification.requestPermission().then(function(permission) {
        console.log(permission);
      });
    }*/
  }
    
   $(function(){
     setTimeout(function() { subscrever(); }, 2000);
     });
  </script>
</head>

<body>
<div id="divNaoSuporta" class="divIFrameInvisivel">
      <p align="center">Notificações não são suportadas no seu navegador.</p>
    </div>
    <div id="divCadastrar" class="divIFrameInvisivel">
      <iframe src="notificacao/oglobo_web_cadastrar.html" class="fullScreen"></iframe>
    </div>
	<script>
      document.write('<img src="http://oglobo.globo.com/pushNotification.do?exibeModal=' + leitorIraVisualizarModalNovamente() + '" style="display:none"  />');
    </script>
</body>

</html>
