<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Notificação de matérias do OGlobo Digital</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link rel="manifest" href="/manifest.json">
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async='async'></script>

  <script>
    var OneSignal = window.OneSignal || [];
    OneSignal.push(["init", {
      appId: "b4d189a8-3ad8-497b-93ec-b50bfa590a8e",
      autoRegister: true, /* Set to true to automatically prompt visitors */
      welcomeNotification: {
	  title: "OGlobo - notificações",
          message: "Obrigado por se subscrever para receber notificações!"
      },
      notifyButton: {
          enable: false /* Set to false to hide */
      }
    }]);
  </script>
  <script>
		/*window.addEventListener('pushsubscriptionchange', function(event) {
			console.log(event);
			console.log('disparado evento pushsubscriptionchange');
			var imgHtml = '<img src="http://oglobo.vm7475.globoi.com/?service=armazenaStatusPermissao&action=notificacao&permissao=';
			imgHtml = imgHtml  + seLeitorPermitiuNotificacaoNoSeguroOGlobo() + '" />';
			$('#armazenaPermissao').append(imgHtml);
		});*/
	   
	  
/*$(window).on("beforeunload", function() { 
window.open("https://google.com.br/",null, "height=200,width=400,status=yes,toolbar=no,menubar=no,location=no");
var imgHtml = '<img src="http://xd.globo.com/busca/?s=pra-rir&p=1" />';
			$('#armazenaPermissao').append(imgHtml);
});*/
	  
	  
window.addEventListener('pushsubscriptionchange', function(event) {
  console.log('Subscription expired');
  event.waitUntil(
    window.registration.pushManager.subscribe({ userVisibleOnly: true })
    .then(function(subscription) {
      console.log('Subscribed after expiration', subscription.endpoint);
    })
  );
});

$(window).on("beforeunload", function() { 
$.ajax({
    url: 'http://xd.globo.com/busca/?s=pra-rir&p=1',
    async: true,
    type: 'GET',
    success: function(res) {
        var data = res;
        console.log('oglobo ',data);
    }
});
});	
</script>
</head>
<body>
  <script>
function seNavegadorImplementaNotificacao() {
	var resultado = false;
	if ('serviceWorker' in window.navigator) {
		resultado = true;
	}
	return resultado;
}
function seLeitorNaoProibeNotificacoes() {
	var resultado = false;
	if ("Notification" in window) {
		if (Notification.permission !== "denied")
			resultado = true;
	}
	return resultado;
}

function seLeitorPermitiuNotificacaoNoSeguroOGlobo() { 
	var resultado = false;
	if (window.navigator != null) {
		if (navigator.serviceWorker != null && navigator.serviceWorker != 'undefined') {
			if (Notification.permission == 'granted')
				resultado = true;
		}		
	}
	return resultado;
}
	  
window.addEventListener("message", function(event) {
    window.temConfigNotifica = function(dados) {
        // Repassa os dados recebidos para a página principal
        // (note que isso força esses dados a serem passados como string)
        event.source.postMessage(JSON.stringify(dados), "*");
    };

    // Aqui é feita a chamada JSONP de fato; fonte: resposta do Sergio
    var script = document.createElement('script');
    script.src = event.data;
    document.body.appendChild(script);

}, false);

  </script>
	
<h3><p align="center">Clique para permitir a ativação do serviço de notificação de conteúdo.</p></h3>

	<div id="teste">

</div>
<div id="armazenaPermissao">

</div>
</body>
</html>
