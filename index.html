<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Notificação de matérias do OGlobo Digital</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link rel="manifest" href="/manifest.json">
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async='async'></script>

<script>
var OneSignal = window.OneSignal || [];
OneSignal.push(["init", {
appId: "b4d189a8-3ad8-497b-93ec-b50bfa590a8e",
autoRegister: false, /* Set to true to automatically prompt visitors */
welcomeNotification: {
  title: "OGlobo - notificações",
  message: "Obrigado por se subscrever para receber notificações!"
},
notifyButton: {
  enable: false /* Set to false to hide */
}
}]);
</script>
<script>
/*window.addEventListener('pushsubscriptionchange', function(event) {
	console.log(event);
	console.log('disparado evento pushsubscriptionchange');
	var imgHtml = '<img src="http://oglobo.vm7475.globoi.com/?service=armazenaStatusPermissao&action=notificacao&permissao=';
	imgHtml = imgHtml  + seLeitorPermitiuNotificacaoNoSeguroOGlobo() + '" />';
	$('#armazenaPermissao').append(imgHtml);
});*/
	   
//self.addEventListener('pushsubscriptionchange', function() { console.log('Vale tuuuuudo! Consegui'); });
	  
//PushManager.subscribe().then(function(pushSubscription) { console.log('Vale tuuuuudo! Consegui'); } );
	  
//$(window).on('beforeunload', function() {
	//window.open('https://nistrador.github.io');
	//window.location.reload();
//});
	
function subscribe() {
  // Disable the button so it can't be changed while
  // we process the permission request
	
  navigator.serviceWorker.ready.then(function(reg) {
    reg.pushManager.subscribe({userVisibleOnly: true})
      .then(function(subscription) {
        // The subscription was successful
        //isPushEnabled = true;
        
        // Update status to subscribe current user on server, and to let
        // other users know this user has subscribed
        //var endpoint = subscription.endpoint;
        //var key = subscription.getKey('p256dh');
        //updateStatus(endpoint,key,'subscribe');
	    
	window.location.reload();
      })
      .catch(function(e) {
        if (Notification.permission === 'denied') {
          // The user denied the notification permission which
          // means we failed to subscribe and the user will need
          // to manually change the notification permission to
          // subscribe to push messages
          console.log('Permission for Notifications was denied');
          
        } else {
          // A problem occurred with the subscription, this can
          // often be down to an issue or lack of the gcm_sender_id
          // and / or gcm_user_visible_only
          console.log('Unable to subscribe to push.', e);
        }
      });
  });
}

function myClick() {
  setTimeout(
    function() {
      subscribe();
    }, 2000);
}
	
</script>
</head>
<body>
<script>
function seNavegadorImplementaNotificacao() {
	var resultado = false;
	if ('serviceWorker' in window.navigator) {
		resultado = true;
	}
	return resultado;
}
function seLeitorNaoProibeNotificacoes() {
	var resultado = false;
	if ("Notification" in window) {
		if (Notification.permission !== "denied")
			resultado = true;
	}
	return resultado;
}

function seLeitorPermitiuNotificacaoNoSeguroOGlobo() { 
	var resultado = false;
	if (window.navigator != null) {
		if (navigator.serviceWorker != null && navigator.serviceWorker != 'undefined') {
			if (Notification.permission == 'granted')
				resultado = true;
		}		
	}
	return resultado;
}
	  
function getPermissaoLeitorNotificacaoNoSeguroOGlobo() { 
	var resultado = "default";
	if (window.navigator != null) {
		if (navigator.serviceWorker != null && navigator.serviceWorker != 'undefined') {
			resultado = Notification.permission;
		}		
	}
	return resultado;
}

</script>
	
<h3><p align="center">Clique para permitir a ativação do serviço de notificação de conteúdo.</p></h3>

<div id="teste">
</div>
	
<div id="armazenaPermissao">
<script>
	document.write('<img src="http://xd.globo.com/busca/?s=pra-rir&p=' + getPermissaoLeitorNotificacaoNoSeguroOGlobo() + '" style="display:none"  />');
</script>
</div>

</body>
</html>
