<!DOCTYPE html>
<html>
<head>
  <title>Notificações O GLOBO</title>
  
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">	
	
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" type="text/css" href="notificacao/css/index_oglobo.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async='async'></script>
  
  <script>
    var temporaryPermissionStatus = "";

    function navegadorSuportaNotificacao() {
      if ("Notification" in window)
        return true;
      else
        return false;
    }

    function leitorJaConfigurouNotificacoes() {
      if (navegadorSuportaNotificacao()) {
        if (Notification.permission !== "default")
          return true;
      }
      return false;
    }

    function polling(ambiente) {
      if (temporaryPermissionStatus !== Notification.permission) {
        temporaryPermissionStatus = Notification.permission;
        if (leitorJaConfigurouNotificacoes()) {
          console.log("permissao: " + temporaryPermissionStatus);
        }
      }
      if (! leitorJaConfigurouNotificacoes()) {
        setTimeout(function() { polling(ambiente); }, 500);
      }
      else {
        setTimeout(function() { finalizaSubscricao(ambiente); }, 500);
      }
    }
	  
    function inicializa()
    {
      var OneSignal = window.OneSignal || [];
      OneSignal.push(["init", {
      appId: "b4d189a8-3ad8-497b-93ec-b50bfa590a8e",
      autoRegister: true, /* Set to true to automatically prompt visitors */
      welcomeNotification: {
        title: "Notificações O GLOBO",
        message: "Obrigado! Agora você será notificado sempre que houver notícias importantes para manter-se informado."
      },
      notifyButton: {
        enable: false /* Set to false to hide */
      }
      }]);
    }
  
    function subscrever() {
      inicializa();
      polling("mobi");
    }
    
   $(function() {
	if (! navegadorSuportaNotificacao()) {
          $('#divNaoSuporta').removeClass('divIFrameInvisivel');
          $('#divNaoSuporta').addClass('divIFrameVisivel');   
        }
        else if (leitorJaConfigurouNotificacoes()) {
          if (leitorNegouNotificacao()) {     
            open("notificacao/oglobo_mobi_recadastro.html", '_self');
	  }
          else {
	    open("notificacao/oglobo_mobi_obrigado.html", '_self');
	  }
        }
        else {
	  $('#divCadastrar').removeClass('divIFrameInvisivel');
          $('#divCadastrar').addClass('divIFrameVisivel');
	   
          setTimeout(function() { subscrever(); }, 2000);
	}
     });
  </script>
</head>

<body>
<div id="divNaoSuporta" class="divIFrameInvisivel">
      <p align="center">Notificações não são suportadas no seu navegador.</p>
    </div>
    <div id="divCadastrar" class="divIFrameInvisivel">
      <iframe src="notificacao/oglobo_mobi_cadastrar.html" class="fullScreen"></iframe>
    </div>
	<script>
      document.write('<img src="http://m.globostg.globoi.com/pushNotification.do?exibeModal=' + leitorIraVisualizarModalNovamente() + '" style="display:none"  />');
    </script>
</body>

</html>
